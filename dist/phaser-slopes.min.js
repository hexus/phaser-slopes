!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Slopes",[],t):"object"==typeof exports?exports.Slopes=t():e.Slopes=t()}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=6)}([function(e,t){var r={};e.exports=r,r.create=function(e,t){return{x:e||0,y:t||0}},r.clone=function(e){return{x:e.x,y:e.y}},r.magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},r.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y},r.rotate=function(e,t,r){var n=Math.cos(t),o=Math.sin(t);r||(r={});var i=e.x*n-e.y*o;return r.y=e.x*o+e.y*n,r.x=i,r},r.rotateAbout=function(e,t,r,n){var o=Math.cos(t),i=Math.sin(t);n||(n={});var a=r.x+((e.x-r.x)*o-(e.y-r.y)*i);return n.y=r.y+((e.x-r.x)*i+(e.y-r.y)*o),n.x=a,n},r.normalise=function(e){var t=r.magnitude(e);return 0===t?{x:0,y:0}:{x:e.x/t,y:e.y/t}},r.dot=function(e,t){return e.x*t.x+e.y*t.y},r.cross=function(e,t){return e.x*t.y-e.y*t.x},r.cross3=function(e,t,r){return(t.x-e.x)*(r.y-e.y)-(t.y-e.y)*(r.x-e.x)},r.add=function(e,t,r){return r||(r={}),r.x=e.x+t.x,r.y=e.y+t.y,r},r.sub=function(e,t,r){return r||(r={}),r.x=e.x-t.x,r.y=e.y-t.y,r},r.mult=function(e,t){return{x:e.x*t,y:e.y*t}},r.div=function(e,t){return{x:e.x/t,y:e.y/t}},r.perp=function(e,t){return{x:(t=!0===t?-1:1)*-e.y,y:t*e.x}},r.neg=function(e){return{x:-e.x,y:-e.y}},r.angle=function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)},r._temp=[r.create(),r.create(),r.create(),r.create(),r.create(),r.create()]},function(e,t,r){
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2018 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
var n=r(5);e.exports=function(e,t,r,o){if(void 0===r&&(r=!1),n(e,t,o)){var i=o.data[t][e];return null===i?null:-1===i.index?r?i:null:i}return null}},function(e,t,r){var n={};e.exports=n;var o=r(0),i=r(4);n.create=function(e,t){for(var r=[],n=0;n<e.length;n++){var o=e[n],i={x:o.x,y:o.y,index:n,body:t,isInternal:!1,contact:null};i.contact={vertex:i,normalImpulse:0,tangentImpulse:0},r.push(i)}return r},n.fromPath=function(e,t){var r=[];return e.replace(/L?\s*([\-\d\.e]+)[\s,]*([\-\d\.e]+)*/gi,(function(e,t,n){r.push({x:parseFloat(t),y:parseFloat(n)})})),n.create(r,t)},n.centre=function(e){for(var t,r,i,a=n.area(e,!0),s={x:0,y:0},l=0;l<e.length;l++)i=(l+1)%e.length,t=o.cross(e[l],e[i]),r=o.mult(o.add(e[l],e[i]),t),s=o.add(s,r);return o.div(s,6*a)},n.mean=function(e){for(var t={x:0,y:0},r=0;r<e.length;r++)t.x+=e[r].x,t.y+=e[r].y;return o.div(t,e.length)},n.area=function(e,t){for(var r=0,n=e.length-1,o=0;o<e.length;o++)r+=(e[n].x-e[o].x)*(e[n].y+e[o].y),n=o;return t?r/2:Math.abs(r)/2},n.inertia=function(e,t){for(var r,n,i=0,a=0,s=e,l=0;l<s.length;l++)n=(l+1)%s.length,i+=(r=Math.abs(o.cross(s[n],s[l])))*(o.dot(s[n],s[n])+o.dot(s[n],s[l])+o.dot(s[l],s[l])),a+=r;return t/6*(i/a)},n.translate=function(e,t,r){var n;if(r)for(n=0;n<e.length;n++)e[n].x+=t.x*r,e[n].y+=t.y*r;else for(n=0;n<e.length;n++)e[n].x+=t.x,e[n].y+=t.y;return e},n.rotate=function(e,t,r){if(0!==t){for(var n=Math.cos(t),o=Math.sin(t),i=0;i<e.length;i++){var a=e[i],s=a.x-r.x,l=a.y-r.y;a.x=r.x+(s*n-l*o),a.y=r.y+(s*o+l*n)}return e}},n.contains=function(e,t){for(var r=0;r<e.length;r++){var n=e[r],o=e[(r+1)%e.length];if((t.x-n.x)*(o.y-n.y)+(t.y-n.y)*(n.x-o.x)>0)return!1}return!0},n.scale=function(e,t,r,i){if(1===t&&1===r)return e;var a,s;i=i||n.centre(e);for(var l=0;l<e.length;l++)a=e[l],s=o.sub(a,i),e[l].x=i.x+s.x*t,e[l].y=i.y+s.y*r;return e},n.chamfer=function(e,t,r,n,a){(t="number"==typeof t?[t]:t||[8]).length||(t=[t]),r=void 0!==r?r:-1,n=n||2,a=a||14;for(var s=[],l=0;l<e.length;l++){var c=e[l-1>=0?l-1:e.length-1],u=e[l],p=e[(l+1)%e.length],d=t[l<t.length?l:t.length-1];if(0!==d){var y=o.normalise({x:u.y-c.y,y:c.x-u.x}),f=o.normalise({x:p.y-u.y,y:u.x-p.x}),g=Math.sqrt(2*Math.pow(d,2)),h=o.mult(i.clone(y),d),x=o.normalise(o.mult(o.add(y,f),.5)),m=o.sub(u,o.mult(x,g)),v=r;-1===r&&(v=1.75*Math.pow(d,.32)),(v=i.clamp(v,n,a))%2==1&&(v+=1);for(var b=Math.acos(o.dot(y,f))/v,L=0;L<v;L++)s.push(o.add(o.rotate(h,b*L),m))}else s.push(u)}return s},n.clockwiseSort=function(e){var t=n.mean(e);return e.sort((function(e,r){return o.angle(t,e)-o.angle(t,r)})),e},n.isConvex=function(e){var t,r,n,o,i=0,a=e.length;if(a<3)return null;for(t=0;t<a;t++)if(n=(t+2)%a,o=(e[r=(t+1)%a].x-e[t].x)*(e[n].y-e[r].y),(o-=(e[r].y-e[t].y)*(e[n].x-e[r].x))<0?i|=1:o>0&&(i|=2),3===i)return!1;return 0!==i||null},n.hull=function(e){var t,r,n=[],i=[];for((e=e.slice(0)).sort((function(e,t){var r=e.x-t.x;return 0!==r?r:e.y-t.y})),r=0;r<e.length;r+=1){for(t=e[r];i.length>=2&&o.cross3(i[i.length-2],i[i.length-1],t)<=0;)i.pop();i.push(t)}for(r=e.length-1;r>=0;r-=1){for(t=e[r];n.length>=2&&o.cross3(n[n.length-2],n[n.length-1],t)<=0;)n.pop();n.push(t)}return n.pop(),i.pop(),n.concat(i)}},function(e,t){var r={};e.exports=r,r.create=function(e){var t={min:{x:0,y:0},max:{x:0,y:0}};return e&&r.update(t,e),t},r.update=function(e,t,r){e.min.x=1/0,e.max.x=-1/0,e.min.y=1/0,e.max.y=-1/0;for(var n=0;n<t.length;n++){var o=t[n];o.x>e.max.x&&(e.max.x=o.x),o.x<e.min.x&&(e.min.x=o.x),o.y>e.max.y&&(e.max.y=o.y),o.y<e.min.y&&(e.min.y=o.y)}r&&(r.x>0?e.max.x+=r.x:e.min.x+=r.x,r.y>0?e.max.y+=r.y:e.min.y+=r.y)},r.contains=function(e,t){return t.x>=e.min.x&&t.x<=e.max.x&&t.y>=e.min.y&&t.y<=e.max.y},r.overlaps=function(e,t){return e.min.x<=t.max.x&&e.max.x>=t.min.x&&e.max.y>=t.min.y&&e.min.y<=t.max.y},r.translate=function(e,t){e.min.x+=t.x,e.max.x+=t.x,e.min.y+=t.y,e.max.y+=t.y},r.shift=function(e,t){var r=e.max.x-e.min.x,n=e.max.y-e.min.y;e.min.x=t.x,e.max.x=t.x+r,e.min.y=t.y,e.max.y=t.y+n}},function(e,t){var r={};e.exports=r,function(){r._nextId=0,r._seed=0,r._nowStartTime=+new Date,r.extend=function(e,t){var n,o;"boolean"==typeof t?(n=2,o=t):(n=1,o=!0);for(var i=n;i<arguments.length;i++){var a=arguments[i];if(a)for(var s in a)o&&a[s]&&a[s].constructor===Object?e[s]&&e[s].constructor!==Object?e[s]=a[s]:(e[s]=e[s]||{},r.extend(e[s],o,a[s])):e[s]=a[s]}return e},r.clone=function(e,t){return r.extend({},t,e)},r.keys=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var r in e)t.push(r);return t},r.values=function(e){var t=[];if(Object.keys){for(var r=Object.keys(e),n=0;n<r.length;n++)t.push(e[r[n]]);return t}for(var o in e)t.push(e[o]);return t},r.get=function(e,t,r,n){t=t.split(".").slice(r,n);for(var o=0;o<t.length;o+=1)e=e[t[o]];return e},r.set=function(e,t,n,o,i){var a=t.split(".").slice(o,i);return r.get(e,t,0,-1)[a[a.length-1]]=n,n},r.shuffle=function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(r.random()*(t+1)),o=e[t];e[t]=e[n],e[n]=o}return e},r.choose=function(e){return e[Math.floor(r.random()*e.length)]},r.isElement=function(e){return e instanceof HTMLElement},r.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},r.isFunction=function(e){return"function"==typeof e},r.isPlainObject=function(e){return"object"==typeof e&&e.constructor===Object},r.isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},r.clamp=function(e,t,r){return e<t?t:e>r?r:e},r.sign=function(e){return e<0?-1:1},r.now=function(){if(window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return new Date-r._nowStartTime},r.random=function(t,r){return r=void 0!==r?r:1,(t=void 0!==t?t:0)+e()*(r-t)};var e=function(){return r._seed=(9301*r._seed+49297)%233280,r._seed/233280};r.colorToNumber=function(e){return 3==(e=e.replace("#","")).length&&(e=e.charAt(0)+e.charAt(0)+e.charAt(1)+e.charAt(1)+e.charAt(2)+e.charAt(2)),parseInt(e,16)},r.logLevel=1,r.log=function(){console&&r.logLevel>0&&r.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},r.info=function(){console&&r.logLevel>0&&r.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},r.warn=function(){console&&r.logLevel>0&&r.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},r.nextId=function(){return r._nextId++},r.map=function(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n+=1)r.push(t(e[n]));return r},r.topologicalSort=function(e){var r=[],n=[],o=[];for(var i in e)n[i]||o[i]||t(i,n,o,e,r);return r};var t=function(e,r,n,o,i){var a=o[e]||[];n[e]=!0;for(var s=0;s<a.length;s+=1){var l=a[s];n[l]||(r[l]||t(l,r,n,o,i))}n[e]=!1,r[e]=!0,i.push(e)};r.chain=function(){for(var e=[],t=0;t<arguments.length;t+=1){var r=arguments[t];r._chained?e.push.apply(e,r._chained):e.push(r)}var n=function(){for(var t,r=new Array(arguments.length),n=0,o=arguments.length;n<o;n++)r[n]=arguments[n];for(n=0;n<e.length;n+=1){var i=e[n].apply(t,r);void 0!==i&&(t=i)}return t};return n._chained=e,n},r.chainPathBefore=function(e,t,n){return r.set(e,t,r.chain(n,r.get(e,t)))},r.chainPathAfter=function(e,t,n){return r.set(e,t,r.chain(r.get(e,t),n))}}()},function(e,t){e.exports=function(e,t,r){return e>=0&&e<r.width&&t>=0&&t<r.height}},function(e,t,r){"use strict";r.r(t);var n=r(0),o=r.n(n);var i={fromVertices:function(e){let t,r,n=[];for(t=0;t<e.length;t++)r=(t+1)%e.length,e[t]&&e[r]?n[t]=o.a.normalise({x:e[r].y-e[t].y,y:e[t].x-e[r].x}):n[t]=null;return n}};let a={preSolvePosition:function(e){let t,r,n,i,a,s,l,c,u,p,d,y={};const f=scene.ecs.engine.systems.debug;for(t=0;t<e.length;t++)(r=e[t]).isActive&&(i=!!r.collision.parentA.edges,a=!!r.collision.parentB.edges,i&&!a||!i&&a?(l=i?r.collision.parentA:r.collision.parentB,s=i?r.collision.parentB:r.collision.parentA,r.isActive=!1,y[s.id]||(y[s.id]=[]),y[s.id].push(r)):(n=r.activeContacts.length,r.collision.parentA.totalContacts+=n,r.collision.parentB.totalContacts+=n));for(t in y)if((u=y[t]).length){for(p=Number.MAX_VALUE,d=null,c=0;c<u.length;c++)(r=u[c]).collision.depth<p&&(p=r.collision.depth,d=r);if(d)for(d.isActive=!0,d.collision.parentA.totalContacts+=d.activeContacts.length,d.collision.parentB.totalContacts+=d.activeContacts.length,c=0;c<u.length;c++){if((r=u[c])===d){f.renderEdgeCollision(r.collision),f.writeCollision(r.collision,{primary:!0});continue}let e=o.a.dot(d.collision.edge.normals[1],r.collision.edge.normals[1])>.99,t=o.a.dot(d.collision.normal,r.collision.normal)>.99,n=o.a.dot(d.collision.normal,r.collision.edge.normals[1])>.99;(e||t||n)&&(r.isActive=!0);let i=o.a.sub(r.collision.edge.position,d.collision.edge.position),a=o.a.dot(i,d.collision.edge.normals[1])>=0,s=o.a.dot(i,r.collision.normal)>=0;(a||s)&&(r.isActive=!0),r.isActive&&(r.collision.parentA.totalContacts+=r.activeContacts.length,r.collision.parentB.totalContacts+=r.activeContacts.length),r.isActive?(f.renderEdgeCollision(r.collision,{lineColor:65535},{fillColor:65535}),f.writeCollision(r.collision,{secondary:!0})):(f.renderEdgeCollision(r.collision,{lineColor:16711680},{fillColor:16711680}),f.writeCollision(r.collision,{disabled:!0}))}}}};var s=a,l=r(2),c=r.n(l);const u=[{min:Number.MAX_VALUE,max:Number.MIN_VALUE},{min:Number.MAX_VALUE,max:Number.MIN_VALUE}],p={collides:function(e,t,r){let n=p.collideBodies(e,t,r);return n.collided?(n.supports=p.findCollisionSupports(n),n):n},collideBodies:function(e,t,r){let n,i,a,s,l,c,u,d,y={overlap:Number.MAX_VALUE},f=!1,g=[];if(r){let o=e.parent,i=t.parent,a=o.speed*o.speed+o.angularSpeed*o.angularSpeed+i.speed*i.speed+i.angularSpeed*i.angularSpeed;f=r&&r.collided&&a<.2&&r.axisNumber>=0,n=r}else n={collided:!1,bodyA:e,bodyB:t};if(f=!1,r&&f){let o=n.axisBody,i=o===e?t:e,a=o.axes[r.axisNumber];if(y=p.overlapAxis(o.vertices,i.vertices,a),n.reused=!0,y.overlap<=0)return n.collided=!1,n}else{if(i=!!e.edges,a=!!t.edges,i&&!a||!i&&a){if(l=i?e:t,s=i?t:e,(u=p.overlapBodyWithEdges(s,l)).overlap<=0)return n.collided=!1,n;y.overlap=u.overlap,y.axis=u.axis,y.axisBody=u.axisBody,y.axisNumber=u.axisNumber,y.edge=u.edge,y.flip=u.flip,y.type=u.type,y.range=u.range}else{for(c=0;c<e.axes.length;c++){if((u=p.overlapAxis(e.vertices,t.vertices,e.axes[c])).overlap<=0)return n.collided=!1,n;u.axisBody=e,u.axisNumber=c,g.push(u)}for(c=0;c<t.axes.length;c++){if((u=p.overlapAxis(t.vertices,e.vertices,t.axes[c])).overlap<=0)return n.collided=!1,n;u.axisBody=t,u.axisNumber=c,g.push(u)}for(d=0;d<g.length;d++){if((u=g[d]).overlap<=0)return n.collided=!1,n;u.overlap<y.overlap&&(y=u)}}n.axisBody=y.axisBody,n.axisNumber=y.axisNumber}return n.bodyA=e.id<t.id?e:t,n.bodyB=e.id<t.id?t:e,n.collided=!0,n.depth=y.overlap,n.edge=y.edge,n.parentA=n.bodyA.parent,n.parentB=n.bodyB.parent,n.type=y.type,n.range=y.range,e=n.bodyA,t=n.bodyB,!y.flip&&o.a.dot(y.axis,o.a.sub(t.position,e.position))<0?n.normal={x:y.axis.x,y:y.axis.y}:n.normal={x:-y.axis.x,y:-y.axis.y},n.tangent=o.a.perp(n.normal),n.penetration=n.penetration||{},n.penetration.x=n.normal.x*n.depth,n.penetration.y=n.normal.y*n.depth,n},overlapNormal:function(e,t,r){let n,o=u[0],i=u[1],a={overlap:Number.MAX_VALUE};return p.projectToAxis(o,e,r),p.projectToAxis(i,t,r),o.min>=i.max||i.min>=o.max?(a.overlap=0,a.axis=r,a):(n=i.max-o.min,a.overlap=n,a.axis=r,a)},overlapBodyWithEdges:function(e,t){let r,n,o,i,a,s=[],l={overlap:Number.MAX_VALUE};for(r=0;r<t.edges.length;r++)(n=t.edges[r]).ignore||(o=p.overlapBodyWithEdge(e,t,n)).overlap<=0||s.push(o);if(!s.length)return l.overlap=0,l;for(i=0;i<s.length;i++)s[i].overlap<l.overlap&&(l=s[i]);return a=t.id<e.id,l.flip=a,l},overlapBodyWithEdge(e,t,r){let n,o,i,a,s=[],l={overlap:Number.MAX_VALUE};if(s[0]=r.vertices[1],s[1]=r.vertices[2],n=r.normalRanges.front,(l=p.overlapNormal(e.vertices,s,n.normal)).overlap<=0)return l;for(l.axisBody=t,l.axisNumber=r.index,l.edge=r,l.type="edge",i=0;i<e.axes.length;i++){if(a=e.axes[i],(o=p.overlapNormal(e.vertices,s,a)).overlap<=0)return o;p.isVectorBetween(o.axis,n.lowerLimit,n.upperLimit)&&(o.axisBody=e,o.axisNumber=i,o.edge=r,o.type="body",o.overlap<l.overlap&&(l=o))}if(l.range=n,"body"===l.type){let e=Math.atan2(l.axis.y,l.axis.x),t=Math.atan2(n.lowerLimit.y,n.lowerLimit.x),r=Math.atan2(n.upperLimit.y,n.upperLimit.x),o=t<=e&&e<=r;o=t>r?!o:o,console.log(l.axis,n.lowerLimit,n.upperLimit,e,t,r,p.isVectorBetween(l.axis,n.lowerLimit,n.upperLimit))}return l},isVectorBetween(e,t,r){let n=Math.atan2(e.y,e.x),o=Math.atan2(t.y,t.x),i=Math.atan2(r.y,r.x);const a=2*Math.PI;return i=(i%=a)>=0?i:i+a,(o=(o%=a)>=0?o:o+a)<=(n=(n%=a)>=0?n:n+a)&&n<=i},overlapAxis:function(e,t,r){let n,o=u[0],i=u[1],a={overlap:Number.MAX_VALUE};return p.projectToAxis(o,e,r),p.projectToAxis(i,t,r),(n=Math.min(o.max-i.min,i.max-o.min))<=0?(a.overlap=n,a.axis=r,a):(n<a.overlap&&(a.overlap=n,a.axis=r),a)},projectToAxis:function(e,t,r){let n,i,a=o.a.dot(t[0],r),s=a;for(n=0;n<t.length;n+=1)(i=o.a.dot(t[n],r))<a&&(a=i),i>s&&(s=i);e.min=a,e.max=s},findSupports:function(e,t,r){let n,i,a,s,l,c,u,p=Number.MAX_VALUE,d=o.a._temp[0],y=t.vertices,f=e.position;for(n=0;n<y.length;n++)a=y[n],d.x=a.x-f.x,d.y=a.y-f.y,(i=-o.a.dot(r,d))<p&&(p=i,s=a);return a=y[l=s.index-1>=0?s.index-1:y.length-1],d.x=a.x-f.x,d.y=a.y-f.y,p=-o.a.dot(r,d),c=a,a=y[u=(s.index+1)%y.length],d.x=a.x-f.x,d.y=a.y-f.y,(i=-o.a.dot(r,d))<p&&(c=a),[s,c]},findCollisionSupports:function(e){let t=e.bodyA,r=e.bodyB,n=p.findSupports(t,r,e.normal),i=[];if(c.a.contains(t.vertices,n[0])&&i.push(n[0]),c.a.contains(t.vertices,n[1])&&i.push(n[1]),i.length<2){let n=p.findSupports(r,t,o.a.neg(e.normal));c.a.contains(r.vertices,n[0])&&i.push(n[0]),i.length<2&&c.a.contains(r.vertices,n[1])&&i.push(n[1])}return i.length<1&&(i=[n[0]]),i}};var d=p,y=r(1),f=r.n(y),g=r(3),h=r.n(g);var x={EMPTY:0,SOLID:1,INTERESTING:2,Directions:{UP:{x:0,y:-1,name:"UP"},DOWN:{x:0,y:1,name:"DOWN"},LEFT:{x:-1,y:0,name:"LEFT"},RIGHT:{x:1,y:0,name:"RIGHT"}}};function m(e){return!(e&&e.physics&&e.physics.matterBody&&e.physics.matterBody.body&&e.physics.matterBody.body.vertices&&e.physics.slopes&&e.physics.slopes.neighbours&&e.physics.slopes.edges)}function v(e,t){return o.a.magnitudeSquared(o.a.sub(e,t))}function b(e,t){let r;for(r=0;r<t.length;r++)if(!t[r].ignore&&1===o.a.dot(e,t[r]))return!0;return!1}function L(e,t,r,n,o){let i={x:t,y:r,index:e,body:n,isInternal:!1,isGhost:o,contact:null};return i.contact={vertex:i,normalImpulse:0,tangentImpulse:0},i}function M(e,t,r,n,a){n=n||null,a=a||null;let s=[];s.push(n?L(0,n.x,n.y,r,!0):null,L(1,e.x,e.y,r),L(2,t.x,t.y,r),a?L(3,a.x,a.y,r,!0):null);let l={vertices:s,normals:null};return l.normals=i.fromVertices(l.vertices),l.position=o.a.create((e.x+t.x)/2,(e.y+t.y)/2),l.index=e.index,l}function w(e){let t,r,n={},i={},a=e.vertices[0],s=e.vertices[1],l=e.vertices[2],c=e.vertices[3],u=!!a,p=!!c,d=o.a.sub(l,s);d=o.a.normalise(d);let y=e.normals[0],f=e.normals[1],g=e.normals[2],h=!1,x=!1;u&&(t=o.a.sub(s,a),t=o.a.normalise(t),h=o.a.cross(t,d)>=0),p&&(r=o.a.sub(c,l),r=o.a.normalise(r),x=o.a.cross(d,r)>=0),u&&p?h&&x?(n.normal=f,n.lowerLimit=y,n.upperLimit=g,i.normal=o.a.neg(f),i.lowerLimit=o.a.neg(f),i.upperLimit=o.a.neg(f)):h?(n.normal=f,n.lowerLimit=y,n.upperLimit=f,i.normal=o.a.neg(f),i.lowerLimit=o.a.neg(g),i.upperLimit=o.a.neg(f)):x?(n.normal=f,n.lowerLimit=f,n.upperLimit=g,i.normal=o.a.neg(f),i.lowerLimit=o.a.neg(f),i.upperLimit=o.a.neg(y)):(n.normal=f,n.lowerLimit=f,n.upperLimit=f,i.normal=o.a.neg(f),i.lowerLimit=o.a.neg(g),i.upperLimit=o.a.neg(y)):u?h?(n.normal=f,n.lowerLimit=y,n.upperLimit=o.a.neg(f),i.normal=o.a.neg(f),i.lowerLimit=f,i.upperLimit=o.a.neg(f)):(n.normal=f,n.lowerLimit=f,n.upperLimit=o.a.neg(f),i.normal=o.a.neg(f),i.lowerLimit=f,i.upperLimit=o.a.neg(y)):p?x?(n.normal=f,n.lowerLimit=o.a.neg(f),n.upperLimit=g,i.normal=o.a.neg(f),i.lowerLimit=o.a.neg(f),i.upperLimit=f):(n.normal=f,n.lowerLimit=o.a.neg(f),n.upperLimit=f,i.normal=o.a.neg(f),i.lowerLimit=o.a.neg(g),i.upperLimit=f):(n.normal=f,n.lowerLimit=o.a.neg(f),n.upperLimit=o.a.neg(f),i.normal=o.a.neg(f),i.lowerLimit=f,i.upperLimit=f),e.convexPrev=h,e.convexNext=x,e.normalRanges={front:n,back:i}}const A={convertTilemapLayer:function(e,t){let r=e.layer,n=e.getTilesWithin(0,0,r.width,r.height,{isColliding:!0});return this.convertTiles(n,t),this.processEdges(e,n),this},processEdges:function(e,t){let r,n=e.layer;for(r in t){let e=t[r];e.physics.slopes=e.physics.slopes||{},e.physics.slopes={neighbours:{up:f()(e.x,e.y-1,!0,n),down:f()(e.x,e.y+1,!0,n),left:f()(e.x-1,e.y,!0,n),right:f()(e.x+1,e.y,!0,n),topLeft:f()(e.x-1,e.y-1,!0,n),topRight:f()(e.x+1,e.y-1,!0,n),bottomLeft:f()(e.x-1,e.y+1,!0,n),bottomRight:f()(e.x+1,e.y+1,!0,n)},edges:{top:x.INTERESTING,bottom:x.INTERESTING,left:x.INTERESTING,right:x.INTERESTING}}}this.calculateBoundaryEdges(t),this.flagInternalEdges(t),this.flagIgnormals(t)},calculateBoundaryEdges:function(e){let t,r,n,i=o.a._temp[0],a=o.a._temp[1],s=o.a._temp[2],l=o.a._temp[3];for(t=0;t<e.length;t++){if(m(r=e[t]))continue;let o=r.physics.matterBody.body.vertices,c=r.pixelX,u=r.pixelX+r.width,p=r.pixelY,d=r.pixelY+r.height;for(i.y=p,i.x=c,a.y=p,a.x=u,s.y=d,s.x=c,l.y=d,l.x=u,n=0;n<o.length;n++){let e=o[n],t=o[(n+1)%o.length];v(e,i)<5&&v(t,a)<5&&(r.physics.slopes.edges.top=x.SOLID),v(e,l)<5&&v(t,s)<5&&(r.physics.slopes.edges.bottom=x.SOLID),v(e,s)<5&&v(t,i)<5&&(r.physics.slopes.edges.left=x.SOLID),v(e,a)<5&&v(t,l)<5&&(r.physics.slopes.edges.right=x.SOLID)}}for(t=0;t<e.length;t++){if(m(r=e[t]))continue;let n=r.physics.slopes.edges,o=r.physics.slopes.neighbours,i=o.up,a=o.down,s=o.left,l=o.right;m(i)||(n.top=this.compareBoundaryEdges(n.top,i.physics.slopes.edges.bottom),r.collideUp=n.top!==x.EMPTY),m(a)||(n.bottom=this.compareBoundaryEdges(n.bottom,a.physics.slopes.edges.top),r.collideDown=n.bottom!==x.EMPTY),m(s)||(n.left=this.compareBoundaryEdges(n.left,s.physics.slopes.edges.right),r.collideLeft=n.left!==x.EMPTY),m(l)||(n.right=this.compareBoundaryEdges(n.right,l.physics.slopes.edges.left),r.collideRight=n.right!==x.EMPTY)}},compareBoundaryEdges:function(e,t){return e===x.SOLID&&t===x.SOLID?x.EMPTY:e===x.SOLID&&t===x.EMPTY?x.EMPTY:e},flagInternalEdges:function(e){const t=["up","down","left","right"];let r,n,i,a,s,l,c,u,p,d;for(r=0;r<e.length;r++){if(m(n=e[r]))continue;let y=n.physics.matterBody.body,f=y.vertices;for(i in t){if(m(a=n.physics.slopes.neighbours[t[i]]))continue;let e=a.physics.matterBody.body,r=e.vertices;if(h.a.overlaps(y.bounds,e.bounds))for(c=f,u=r,p=y.axes,d=e.axes,s=0;s<c.length;s++)for(l=0;l<u.length;l++){let e=o.a.magnitudeSquared(o.a.sub(c[(s+1)%c.length],u[l])),t=o.a.magnitudeSquared(o.a.sub(c[s],u[(l+1)%u.length]));e<5&&t<5&&(c[s].isInternal=!0,u[l].isInternal=!0,p[s].ignore=!0,d[l].ignore=!0)}}}},flagIgnormals:function(e){let t,r,n,a,s,l,c,u,p,d,y,f,g,A,E,P,I;for(t=0;t<e.length;t++)if(!m(r=e[t])){for(a=(n=r.physics.matterBody.body).vertices,n.edges=[],n.ignormals=[],p=0;p<a.length;p++)f=a[p],g=a[(p+1)%a.length],I=n.edges[p],(I=M(f,g,n)).ignore=f.isInternal,n.edges[p]=I;for(s in r.physics.slopes.neighbours)if(!m(l=r.physics.slopes.neighbours[s])&&(u=(c=l.physics.matterBody.body).vertices,h.a.overlaps(n.bounds,c.bounds)))for(p=0;p<a.length;p++)for(f=a[p],g=a[(p+1)%a.length],I=n.edges[p],d=0;d<u.length;d++){if(E=u[d],P=u[(d+1)%u.length],E.isInternal)continue;let e=v(f,P)<5,t=v(g,E)<5;if(e||t){e&&!I.vertices[0]&&(I.vertices[0]=L(0,E.x,E.y,n,!0),c.edges&&(I.prev=c.edges[d],c.edges[d].next=I)),t&&!I.vertices[3]&&(I.vertices[3]=L(3,P.x,P.y,n,!0));let r=e?P:E,i=n.axes[p],a=c.axes[d];o.a.dot(i,a)>0&&(Math.abs(r.x-n.bounds.min.x)<1&&!b(x.Directions.LEFT,n.axes)&&o.a.dot(i,x.Directions.LEFT)<1&&o.a.dot(a,x.Directions.LEFT)<1&&n.ignormals.push(x.Directions.LEFT),Math.abs(r.y-n.bounds.min.y)<1&&!b(x.Directions.UP,n.axes)&&o.a.dot(i,x.Directions.UP)<1&&o.a.dot(a,x.Directions.UP)<1&&n.ignormals.push(x.Directions.UP),Math.abs(r.x-n.bounds.max.x)<1&&!b(x.Directions.RIGHT,n.axes)&&o.a.dot(i,x.Directions.RIGHT)<1&&o.a.dot(a,x.Directions.RIGHT)<1&&n.ignormals.push(x.Directions.RIGHT),Math.abs(r.y-n.bounds.max.y)<1&&!b(x.Directions.DOWN,n.axes)&&o.a.dot(i,x.Directions.DOWN)<1&&o.a.dot(a,x.Directions.DOWN)<1&&n.ignormals.push(x.Directions.DOWN))}}for(p=0;p<a.length;p++)(I=n.edges[p]).ignore||(y=a[((p-1)%a.length+a.length)%a.length],f=a[p],g=a[(p+1)%a.length],A=a[(p+2)%a.length],I.vertices[0]||y.isInternal||(I.vertices[0]=L(0,y.x,y.y,n,!0)),I.vertices[3]||g.isInternal||(I.vertices[3]=L(3,A.x,A.y,n,!0)),I.normals=i.fromVertices(I.vertices),w(I))}}};var E={Matter:{Axes:i,Resolver:s,SAT:d,World:A}};class P{constructor(e){this.scene=e,this.overridden={}}boot(){let e=this.scene.sys.events;e.on("start",this.start,this),e.on("shutdown",this.shutdown,this),e.on("destroy",this.destroy,this),this.start()}start(){if(!Phaser||!Phaser.Physics||!Phaser.Physics.Matter)return void console.warn("Phaser Slopes plugin could not find Phaser or Matter.js during start up");let e=Phaser.Physics.Matter.Matter.Axes,t=Phaser.Physics.Matter.Matter.Resolver,r=Phaser.Physics.Matter.Matter.SAT,n=Phaser.Physics.Matter.World;this.overridden.convertTilemapLayer=n.prototype.convertTilemapLayer,this.overridden.processEdges=n.prototype.processEdges,this.overridden.collides=r.collides,this.overridden.fromVertices=e.fromVertices,this.overridden.solvePosition=t.solvePosition,this.overridden.preSolvePosition=t.preSolvePosition,e.fromVertices=E.Matter.Axes.fromVertices,t.preSolvePosition=E.Matter.Resolver.preSolvePosition,r.collides=E.Matter.SAT.collides,n.prototype.convertTilemapLayer=E.Matter.World.convertTilemapLayer,n.prototype.processEdges=E.Matter.World.processEdges,n.prototype.calculateBoundaryEdges=E.Matter.World.calculateBoundaryEdges,n.prototype.compareBoundaryEdges=E.Matter.World.compareBoundaryEdges,n.prototype.calculateEdgeNormals=E.Matter.World.calculateEdgeNormals,n.prototype.flagInternalEdges=E.Matter.World.flagInternalEdges,n.prototype.flagIgnoredAxes=E.Matter.World.flagIgnoredAxes,n.prototype.flagIgnormals=E.Matter.World.flagIgnormals}shutdown(){if(!Phaser||!Phaser.Physics)return void console.warn("Phaser Slopes plugin could not find Phaser during shutdown");let e=Phaser.Physics.Matter.Matter.Axes,t=Phaser.Physics.Matter.Matter.Resolver,r=Phaser.Physics.Matter.Matter.SAT,n=Phaser.Physics.Matter.World;e.fromVertices=this.overridden.fromVertices,t.preSolvePosition=this.overridden.preSolvePosition,t.solvePosition=this.overridden.solvePosition,r.collides=this.overridden.collides,n.prototype.convertTilemapLayer=this.overridden.convertTilemapLayer,n.prototype.processEdges=this.overridden.processEdges,delete n.prototype.calculateBoundaryEdges,delete n.prototype.compareBoundaryEdges,delete n.prototype.calculateEdgeNormals,delete n.prototype.flagInternalEdges,delete n.prototype.flagIgnoredAxes,delete n.prototype.flagIgnormals}destroy(){this.shutdown(),this.scene=null,this.overridden=null}}Phaser=Phaser||{},Phaser.Plugins=Phaser.Plugins||{},Phaser.Plugins.Slopes=P;t.default=P}]).default}));