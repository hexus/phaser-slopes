!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/dist/",r(r.s=4)}([function(e,t){var r={};e.exports=r,r.create=function(e,t){return{x:e||0,y:t||0}},r.clone=function(e){return{x:e.x,y:e.y}},r.magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},r.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y},r.rotate=function(e,t,r){var n=Math.cos(t),o=Math.sin(t);r||(r={});var i=e.x*n-e.y*o;return r.y=e.x*o+e.y*n,r.x=i,r},r.rotateAbout=function(e,t,r,n){var o=Math.cos(t),i=Math.sin(t);n||(n={});var s=r.x+((e.x-r.x)*o-(e.y-r.y)*i);return n.y=r.y+((e.x-r.x)*i+(e.y-r.y)*o),n.x=s,n},r.normalise=function(e){var t=r.magnitude(e);return 0===t?{x:0,y:0}:{x:e.x/t,y:e.y/t}},r.dot=function(e,t){return e.x*t.x+e.y*t.y},r.cross=function(e,t){return e.x*t.y-e.y*t.x},r.cross3=function(e,t,r){return(t.x-e.x)*(r.y-e.y)-(t.y-e.y)*(r.x-e.x)},r.add=function(e,t,r){return r||(r={}),r.x=e.x+t.x,r.y=e.y+t.y,r},r.sub=function(e,t,r){return r||(r={}),r.x=e.x-t.x,r.y=e.y-t.y,r},r.mult=function(e,t){return{x:e.x*t,y:e.y*t}},r.div=function(e,t){return{x:e.x/t,y:e.y/t}},r.perp=function(e,t){return{x:(t=!0===t?-1:1)*-e.y,y:t*e.x}},r.neg=function(e){return{x:-e.x,y:-e.y}},r.angle=function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)},r._temp=[r.create(),r.create(),r.create(),r.create(),r.create(),r.create()]},function(e,t,r){var n=r(5);e.exports=function(e,t,r,o){if(void 0===r&&(r=!1),n(e,t,o)){var i=o.data[t][e];return null===i?null:-1===i.index?r?i:null:i}return null}},function(e,t,r){var n={};e.exports=n;var o=r(0),i=r(6);n.create=function(e,t){for(var r=[],n=0;n<e.length;n++){var o=e[n],i={x:o.x,y:o.y,index:n,body:t,isInternal:!1,contact:null};i.contact={vertex:i,normalImpulse:0,tangentImpulse:0},r.push(i)}return r},n.fromPath=function(e,t){var r=[];return e.replace(/L?\s*([\-\d\.e]+)[\s,]*([\-\d\.e]+)*/gi,function(e,t,n){r.push({x:parseFloat(t),y:parseFloat(n)})}),n.create(r,t)},n.centre=function(e){for(var t,r,i,s=n.area(e,!0),a={x:0,y:0},l=0;l<e.length;l++)i=(l+1)%e.length,t=o.cross(e[l],e[i]),r=o.mult(o.add(e[l],e[i]),t),a=o.add(a,r);return o.div(a,6*s)},n.mean=function(e){for(var t={x:0,y:0},r=0;r<e.length;r++)t.x+=e[r].x,t.y+=e[r].y;return o.div(t,e.length)},n.area=function(e,t){for(var r=0,n=e.length-1,o=0;o<e.length;o++)r+=(e[n].x-e[o].x)*(e[n].y+e[o].y),n=o;return t?r/2:Math.abs(r)/2},n.inertia=function(e,t){for(var r,n,i=0,s=0,a=e,l=0;l<a.length;l++)n=(l+1)%a.length,i+=(r=Math.abs(o.cross(a[n],a[l])))*(o.dot(a[n],a[n])+o.dot(a[n],a[l])+o.dot(a[l],a[l])),s+=r;return t/6*(i/s)},n.translate=function(e,t,r){var n;if(r)for(n=0;n<e.length;n++)e[n].x+=t.x*r,e[n].y+=t.y*r;else for(n=0;n<e.length;n++)e[n].x+=t.x,e[n].y+=t.y;return e},n.rotate=function(e,t,r){if(0!==t){for(var n=Math.cos(t),o=Math.sin(t),i=0;i<e.length;i++){var s=e[i],a=s.x-r.x,l=s.y-r.y;s.x=r.x+(a*n-l*o),s.y=r.y+(a*o+l*n)}return e}},n.contains=function(e,t){for(var r=0;r<e.length;r++){var n=e[r],o=e[(r+1)%e.length];if((t.x-n.x)*(o.y-n.y)+(t.y-n.y)*(n.x-o.x)>0)return!1}return!0},n.scale=function(e,t,r,i){if(1===t&&1===r)return e;var s,a;i=i||n.centre(e);for(var l=0;l<e.length;l++)s=e[l],a=o.sub(s,i),e[l].x=i.x+a.x*t,e[l].y=i.y+a.y*r;return e},n.chamfer=function(e,t,r,n,s){(t="number"==typeof t?[t]:t||[8]).length||(t=[t]),r=void 0!==r?r:-1,n=n||2,s=s||14;for(var a=[],l=0;l<e.length;l++){var c=e[l-1>=0?l-1:e.length-1],u=e[l],p=e[(l+1)%e.length],d=t[l<t.length?l:t.length-1];if(0!==d){var y=o.normalise({x:u.y-c.y,y:c.x-u.x}),g=o.normalise({x:p.y-u.y,y:u.x-p.x}),x=Math.sqrt(2*Math.pow(d,2)),h=o.mult(i.clone(y),d),f=o.normalise(o.mult(o.add(y,g),.5)),m=o.sub(u,o.mult(f,x)),v=r;-1===r&&(v=1.75*Math.pow(d,.32)),(v=i.clamp(v,n,s))%2==1&&(v+=1);for(var b=Math.acos(o.dot(y,g))/v,L=0;L<v;L++)a.push(o.add(o.rotate(h,b*L),m))}else a.push(u)}return a},n.clockwiseSort=function(e){var t=n.mean(e);return e.sort(function(e,r){return o.angle(t,e)-o.angle(t,r)}),e},n.isConvex=function(e){var t,r,n,o,i=0,s=e.length;if(s<3)return null;for(t=0;t<s;t++)if(n=(t+2)%s,o=(e[r=(t+1)%s].x-e[t].x)*(e[n].y-e[r].y),(o-=(e[r].y-e[t].y)*(e[n].x-e[r].x))<0?i|=1:o>0&&(i|=2),3===i)return!1;return 0!==i||null},n.hull=function(e){var t,r,n=[],i=[];for((e=e.slice(0)).sort(function(e,t){var r=e.x-t.x;return 0!==r?r:e.y-t.y}),r=0;r<e.length;r+=1){for(t=e[r];i.length>=2&&o.cross3(i[i.length-2],i[i.length-1],t)<=0;)i.pop();i.push(t)}for(r=e.length-1;r>=0;r-=1){for(t=e[r];n.length>=2&&o.cross3(n[n.length-2],n[n.length-1],t)<=0;)n.pop();n.push(t)}return n.pop(),i.pop(),n.concat(i)}},function(e,t){var r={};e.exports=r,r.create=function(e){var t={min:{x:0,y:0},max:{x:0,y:0}};return e&&r.update(t,e),t},r.update=function(e,t,r){e.min.x=1/0,e.max.x=-1/0,e.min.y=1/0,e.max.y=-1/0;for(var n=0;n<t.length;n++){var o=t[n];o.x>e.max.x&&(e.max.x=o.x),o.x<e.min.x&&(e.min.x=o.x),o.y>e.max.y&&(e.max.y=o.y),o.y<e.min.y&&(e.min.y=o.y)}r&&(r.x>0?e.max.x+=r.x:e.min.x+=r.x,r.y>0?e.max.y+=r.y:e.min.y+=r.y)},r.contains=function(e,t){return t.x>=e.min.x&&t.x<=e.max.x&&t.y>=e.min.y&&t.y<=e.max.y},r.overlaps=function(e,t){return e.min.x<=t.max.x&&e.max.x>=t.min.x&&e.max.y>=t.min.y&&e.min.y<=t.max.y},r.translate=function(e,t){e.min.x+=t.x,e.max.x+=t.x,e.min.y+=t.y,e.max.y+=t.y},r.shift=function(e,t){var r=e.max.x-e.min.x,n=e.max.y-e.min.y;e.min.x=t.x,e.max.x=t.x+r,e.min.y=t.y,e.max.y=t.y+n}},function(e,t,r){"use strict";r.r(t);var n=r(0),o=r.n(n);var i={fromVertices:function(e){let t,r,n=[];for(t=0;t<e.length;t++)r=(t+1)%e.length,e[t]&&e[r]?n[t]=o.a.normalise({x:e[r].y-e[t].y,y:e[t].x-e[r].x}):n[t]=null;return n}};let s={preSolvePosition:function(e){let t,r,n,i,s,a,l,c,u,p,d,y={};for(t=0;t<e.length;t++)(r=e[t]).isActive&&(i=!!r.collision.parentA.edges,s=!!r.collision.parentB.edges,i&&!s||!i&&s?(l=i?r.collision.parentA:r.collision.parentB,a=i?r.collision.parentB:r.collision.parentA,r.isActive=!1,y[a.id]||(y[a.id]=[]),y[a.id].push(r)):(n=r.activeContacts.length,r.collision.parentA.totalContacts+=n,r.collision.parentB.totalContacts+=n));for(t in y)if((u=y[t]).length){for(p=Number.MAX_VALUE,d=null,c=0;c<u.length;c++)(r=u[c]).collision.depth<p&&(p=r.collision.depth,d=r);for(d.isActive=!0,d.collision.parentA.totalContacts+=d.activeContacts.length,d.collision.parentB.totalContacts+=d.activeContacts.length,c=0;c<u.length;c++){if((r=u[c])===d){scene.ecs.engine.systems.debug.renderMatterBodyEdge(r.collision.edge);continue}let e=o.a.sub(r.collision.edge.position,d.collision.edge.position);o.a.dot(e,r.collision.edge.normals[1])<0&&(r.isActive=!0),o.a.dot(d.collision.normal,r.collision.normal)>.99&&(r.isActive=!0),r.isActive&&(scene.ecs.engine.systems.debug.renderMatterBodyEdge(r.collision.edge),r.collision.parentA.totalContacts+=r.activeContacts.length,r.collision.parentB.totalContacts+=r.activeContacts.length)}}}};var a=s,l=r(2),c=r.n(l);const u={collides:function(e,t,r){let n=u.collideBodies(e,t,r);return n.collided?(n.supports=u.findCollisionSupports(n),n):n},collideBodies:function(e,t,r){let n,i,s,a,l,c,p,d,y,g,x,h,f,m={overlap:Number.MAX_VALUE},v=!1,b=[];if(r){let o=e.parent,i=t.parent,s=o.speed*o.speed+o.angularSpeed*o.angularSpeed+i.speed*i.speed+i.angularSpeed*i.angularSpeed;v=r&&r.collided&&s<.2&&r.axisNumber>=0,n=r}else n={collided:!1,bodyA:e,bodyB:t};if(v=!1,r&&v){let o=n.axisBody,i=o===e?t:e,s=o.axes[r.axisNumber];if(m=u.overlapAxis(o.vertices,i.vertices,s),n.reused=!0,m.overlap<=0)return n.collided=!1,n}else{for(i=(e.ignormals||[]).concat(t.ignormals||[]),p=0;p<e.axes.length;p++)e.axes[p].ignore&&i.push(e.axes[p]);for(p=0;p<t.axes.length;p++)t.axes[p].ignore&&i.push(t.axes[p]);if(s=!!e.edges,a=!!t.edges,s&&!a||!s&&a){if(c=s?e:t,l=s?t:e,console.assert(!!c.edges),console.assert(!l.edges),(d=u.overlapBodyWithEdges(l,c)).overlap<=0)return n.collided=!1,n;console.assert(!0===d.flip),m.overlap=d.overlap,m.axis=d.axis,m.axisBody=d.axisBody,m.axisNumber=d.axisNumber,m.edge=d.edge,m.flip=d.flip}else{for(p=0;p<e.axes.length;p++)(d=u.overlapAxis(e.vertices,t.vertices,e.axes[p])).axisBody=e,d.axisNumber=p,b.push(d);for(p=0;p<t.axes.length;p++)(d=u.overlapAxis(t.vertices,e.vertices,t.axes[p])).axisBody=t,d.axisNumber=p,b.push(d);for(y=!1,g=!1,x=0;x<b.length;x++){if((d=b[x]).overlap<=0)return n.collided=!1,n;for(h=o.a.dot(d.axis,o.a.sub(t.position,e.position))<0?d.axis:o.a.neg(d.axis),g=!1,f=0;f<i.length;f++)if(o.a.dot(h,i[f])>=.99){g=!0;break}g||d.overlap<m.overlap&&(y=!0,m=d)}if(!y)return n.collided=!1,n}n.axisBody=m.axisBody,n.axisNumber=m.axisNumber,n.ignormals=i}return n.bodyA=e.id<t.id?e:t,n.bodyB=e.id<t.id?t:e,n.collided=!0,n.depth=m.overlap,n.edge=m.edge,n.parentA=n.bodyA.parent,n.parentB=n.bodyB.parent,e=n.bodyA,t=n.bodyB,!m.flip&&o.a.dot(m.axis,o.a.sub(t.position,e.position))<0?n.normal={x:m.axis.x,y:m.axis.y}:n.normal={x:-m.axis.x,y:-m.axis.y},n.tangent=o.a.perp(n.normal),n.penetration=n.penetration||{},n.penetration.x=n.normal.x*n.depth,n.penetration.y=n.normal.y*n.depth,n},overlapNormal:function(e,t,r){let n,o={},i={},s={overlap:Number.MAX_VALUE};return u.projectToAxis(o,e,r),u.projectToAxis(i,t,r),o.min>=i.max||i.min>=o.max?(s.overlap=0,s.axis=r,s):(n=i.max-o.min,s.overlap=n,s.axis=r,s.projectionA=o,s.projectionB=i,s)},overlapBodyWithEdges:function(e,t){let r,n,o,i,s,a=[],l={overlap:Number.MAX_VALUE};for(r=0;r<t.edges.length;r++)(n=t.edges[r]).ignore||(o=u.overlapBodyWithEdge(e,t,n)).overlap<=0||a.push(o);if(!a.length)return l.overlap=0,l;for(console.assert(l.overlap===Number.MAX_VALUE),i=0;i<a.length;i++)a[i].overlap<l.overlap&&(l=a[i]);return e.id,scene.player.body.id,s=t.id<e.id,l.flip=s,l},overlapBodyWithEdge(e,t,r){let n,i,s,a,l,c,p=[],d={overlap:Number.MAX_VALUE};if(p.length||(p[0]=r.vertices[1],p[1]=r.vertices[2]),n=r.normalRanges.front,d=u.overlapNormal(e.vertices,p,n.normal),e.id,scene.player.body.id,d.overlap<=0)return d;for(d.axisBody=t,d.axisNumber=r.index,d.edge=r,d.type="edge",i=o.a.cross(n.lowerLimit,n.upperLimit),l=0;l<e.axes.length;l++){if(c=e.axes[l],(s=u.overlapNormal(e.vertices,p,c)).overlap<=0)return s;o.a.dot(c,n.normal)<=0||(a=!1,i>=0?o.a.cross(n.lowerLimit,c)>=0&&o.a.cross(c,n.upperLimit)>=0&&(a=!0):o.a.cross(n.upperLimit,c)>=0&&o.a.cross(c,n.lowerLimit)>=0||(a=!0),a&&(s.axisBody=e,s.axisNumber=l,s.edge=r,s.type="body",e.id,scene.player.body.id,s.overlap<d.overlap&&(d=s)))}return d},overlapAxis:function(e,t,r){let n,i=o.a._temp[0],s=o.a._temp[1],a={overlap:Number.MAX_VALUE};return u.projectToAxis(i,e,r),u.projectToAxis(s,t,r),(n=Math.min(i.max-s.min,s.max-i.min))<=0?(a.overlap=n,a.axis=r,a):(n<a.overlap&&(a.overlap=n,a.axis=r),a)},overlapAxes:function(e,t,r){let n,i,s,a,l=o.a._temp[0],c=o.a._temp[1],p=[];for(n=0;n<r.length;n++)i={},a=r[n],u.projectToAxis(l,e,a),u.projectToAxis(c,t,a),s=Math.min(l.max-c.min,c.max-l.min),i.overlap=s,i.axis=a,i.axisNumber=n,p.push(i);return p},projectToAxis:function(e,t,r){let n,i,s=o.a.dot(t[0],r),a=s;for(n=0;n<t.length;n+=1)(i=o.a.dot(t[n],r))<s&&(s=i),i>a&&(a=i);e.min=s,e.max=a},findSupports:function(e,t,r){let n,i,s,a,l,c,u,p=Number.MAX_VALUE,d=o.a._temp[0],y=t.vertices,g=e.position;for(n=0;n<y.length;n++)s=y[n],d.x=s.x-g.x,d.y=s.y-g.y,(i=-o.a.dot(r,d))<p&&(p=i,a=s);return s=y[l=a.index-1>=0?a.index-1:y.length-1],d.x=s.x-g.x,d.y=s.y-g.y,p=-o.a.dot(r,d),c=s,s=y[u=(a.index+1)%y.length],d.x=s.x-g.x,d.y=s.y-g.y,(i=-o.a.dot(r,d))<p&&(c=s),[a,c]},findCollisionSupports:function(e){let t=e.bodyA,r=e.bodyB,n=u.findSupports(t,r,e.normal),i=[];if(c.a.contains(t.vertices,n[0])&&i.push(n[0]),c.a.contains(t.vertices,n[1])&&i.push(n[1]),i.length<2){let n=u.findSupports(r,t,o.a.neg(e.normal));c.a.contains(r.vertices,n[0])&&i.push(n[0]),i.length<2&&c.a.contains(r.vertices,n[1])&&i.push(n[1])}return i.length<1&&(i=[n[0]]),i}};var p=u,d=r(1),y=r.n(d),g=r(3),x=r.n(g);var h={EMPTY:0,SOLID:1,INTERESTING:2,Directions:{UP:{x:0,y:-1,name:"UP"},DOWN:{x:0,y:1,name:"DOWN"},LEFT:{x:-1,y:0,name:"LEFT"},RIGHT:{x:1,y:0,name:"RIGHT"}}};function f(e){return!(e&&e.physics&&e.physics.matterBody&&e.physics.matterBody.body&&e.physics.matterBody.body.vertices&&e.physics.slopes&&e.physics.slopes.neighbours&&e.physics.slopes.edges)}function m(e,t){return o.a.magnitudeSquared(o.a.sub(e,t))}function v(e,t){let r;for(r=0;r<t.length;r++)if(!t[r].ignore&&1===o.a.dot(e,t[r]))return!0;return!1}function b(e,t,r,n,o){let i={x:t,y:r,index:e,body:n,isInternal:!1,isGhost:o,contact:null};return i.contact={vertex:i,normalImpulse:0,tangentImpulse:0},i}function L(e,t,r,n,s){n=n||null,s=s||null;let a=[];a.push(n?b(0,n.x,n.y,r,!0):null,b(1,e.x,e.y,r),b(2,t.x,t.y,r),s?b(3,s.x,s.y,r,!0):null);let l={vertices:a,normals:null};return l.normals=i.fromVertices(l.vertices),l.position=o.a.create((e.x+t.x)/2,(e.y+t.y)/2),l.index=e.index,l}function A(e){let t,r,n={},i={},s=e.vertices[0],a=e.vertices[1],l=e.vertices[2],c=e.vertices[3],u=!!s,p=!!c,d=o.a.sub(l,a);d=o.a.normalise(d);let y=e.normals[0],g=e.normals[1],x=e.normals[2],h=!1,f=!1;u&&(t=o.a.sub(a,s),t=o.a.normalise(t),h=o.a.cross(t,d)>=0),p&&(r=o.a.sub(c,l),r=o.a.normalise(r),f=o.a.cross(d,r)>=0),u&&p?h&&f?(n.normal=g,n.lowerLimit=y,n.upperLimit=x,i.normal=o.a.neg(g),i.lowerLimit=o.a.neg(g),i.upperLimit=o.a.neg(g)):h?(n.normal=g,n.lowerLimit=y,n.upperLimit=g,i.normal=o.a.neg(g),i.lowerLimit=o.a.neg(x),i.upperLimit=o.a.neg(g)):f?(n.normal=g,n.lowerLimit=g,n.upperLimit=x,i.normal=o.a.neg(g),i.lowerLimit=o.a.neg(g),i.upperLimit=o.a.neg(y)):(n.normal=g,n.lowerLimit=g,n.upperLimit=g,i.normal=o.a.neg(g),i.lowerLimit=o.a.neg(x),i.upperLimit=o.a.neg(y)):u?h?(n.normal=g,n.lowerLimit=y,n.upperLimit=o.a.neg(g),i.normal=o.a.neg(g),i.lowerLimit=g,i.upperLimit=o.a.neg(g)):(n.normal=g,n.lowerLimit=g,n.upperLimit=o.a.neg(g),i.normal=o.a.neg(g),i.lowerLimit=g,i.upperLimit=o.a.neg(y)):p?f?(n.normal=g,n.lowerLimit=o.a.neg(g),n.upperLimit=x,i.normal=o.a.neg(g),i.lowerLimit=o.a.neg(g),i.upperLimit=g):(n.normal=g,n.lowerLimit=o.a.neg(g),n.upperLimit=g,i.normal=o.a.neg(g),i.lowerLimit=o.a.neg(x),i.upperLimit=g):(n.normal=g,n.lowerLimit=o.a.neg(g),n.upperLimit=o.a.neg(g),i.normal=o.a.neg(g),i.lowerLimit=g,i.upperLimit=g),e.convexPrev=h,e.convexNext=f,e.normalRanges={front:n,back:i}}var E={Matter:{Axes:i,Resolver:a,SAT:p,World:{convertTilemapLayer:function(e,t){let r=e.layer,n=e.getTilesWithin(0,0,r.width,r.height,{isColliding:!0});return this.convertTiles(n,t),this.processEdges(e,n),this},processEdges:function(e,t){let r,n=e.layer;for(r in t){let e=t[r];e.physics.slopes=e.physics.slopes||{},e.physics.slopes={neighbours:{up:y()(e.x,e.y-1,!0,n),down:y()(e.x,e.y+1,!0,n),left:y()(e.x-1,e.y,!0,n),right:y()(e.x+1,e.y,!0,n),topLeft:y()(e.x-1,e.y-1,!0,n),topRight:y()(e.x+1,e.y-1,!0,n),bottomLeft:y()(e.x-1,e.y+1,!0,n),bottomRight:y()(e.x+1,e.y+1,!0,n)},edges:{top:h.INTERESTING,bottom:h.INTERESTING,left:h.INTERESTING,right:h.INTERESTING}}}this.calculateBoundaryEdges(t),this.flagInternalEdges(t),this.flagIgnormals(t)},calculateBoundaryEdges:function(e){let t,r,n,i=o.a._temp[0],s=o.a._temp[1],a=o.a._temp[2],l=o.a._temp[3];for(t=0;t<e.length;t++){if(f(r=e[t]))continue;let o=r.physics.matterBody.body.vertices,c=r.pixelX,u=r.pixelX+r.width,p=r.pixelY,d=r.pixelY+r.height;for(i.y=p,i.x=c,s.y=p,s.x=u,a.y=d,a.x=c,l.y=d,l.x=u,n=0;n<o.length;n++){let e=o[n],t=o[(n+1)%o.length];m(e,i)<5&&m(t,s)<5&&(r.physics.slopes.edges.top=h.SOLID),m(e,l)<5&&m(t,a)<5&&(r.physics.slopes.edges.bottom=h.SOLID),m(e,a)<5&&m(t,i)<5&&(r.physics.slopes.edges.left=h.SOLID),m(e,s)<5&&m(t,l)<5&&(r.physics.slopes.edges.right=h.SOLID)}}for(t=0;t<e.length;t++){if(f(r=e[t]))continue;let n=r.physics.slopes.edges,o=r.physics.slopes.neighbours,i=o.up,s=o.down,a=o.left,l=o.right;f(i)||(n.top=this.compareBoundaryEdges(n.top,i.physics.slopes.edges.bottom),r.collideUp=n.top!==h.EMPTY),f(s)||(n.bottom=this.compareBoundaryEdges(n.bottom,s.physics.slopes.edges.top),r.collideDown=n.bottom!==h.EMPTY),f(a)||(n.left=this.compareBoundaryEdges(n.left,a.physics.slopes.edges.right),r.collideLeft=n.left!==h.EMPTY),f(l)||(n.right=this.compareBoundaryEdges(n.right,l.physics.slopes.edges.left),r.collideRight=n.right!==h.EMPTY)}},compareBoundaryEdges:function(e,t){return e===h.SOLID&&t===h.SOLID?h.EMPTY:e===h.SOLID&&t===h.EMPTY?h.EMPTY:e},flagInternalEdges:function(e){const t=["up","down","left","right"];let r,n,i,s,a,l,c,u,p,d;for(r=0;r<e.length;r++){if(f(n=e[r]))continue;let y=n.physics.matterBody.body,g=y.vertices;for(i in t){if(f(s=n.physics.slopes.neighbours[t[i]]))continue;let e=s.physics.matterBody.body,r=e.vertices;if(x.a.overlaps(y.bounds,e.bounds))for(c=g,u=r,p=y.axes,d=e.axes,a=0;a<c.length;a++)for(l=0;l<u.length;l++){let e=o.a.magnitudeSquared(o.a.sub(c[(a+1)%c.length],u[l])),t=o.a.magnitudeSquared(o.a.sub(c[a],u[(l+1)%u.length]));e<5&&t<5&&(c[a].isInternal=!0,u[l].isInternal=!0,p[a].ignore=!0,d[l].ignore=!0)}}}},flagIgnormals:function(e){let t,r,n,s,a,l,c,u,p,d,y,g,E,M,w,P,T;for(t=0;t<e.length;t++)if(!f(r=e[t])){for(s=(n=r.physics.matterBody.body).vertices,n.edges=[],n.ignormals=[],p=0;p<s.length;p++)g=s[p],E=s[(p+1)%s.length],T=n.edges[p],(T=L(g,E,n)).ignore=g.isInternal,n.edges[p]=T;for(a in r.physics.slopes.neighbours)if(!f(l=r.physics.slopes.neighbours[a])&&(u=(c=l.physics.matterBody.body).vertices,x.a.overlaps(n.bounds,c.bounds)))for(p=0;p<s.length;p++)for(g=s[p],E=s[(p+1)%s.length],T=n.edges[p],d=0;d<u.length;d++){if(w=u[d],P=u[(d+1)%u.length],w.isInternal)continue;let e=m(g,P)<5,t=m(E,w)<5;if(e||t){e&&!T.vertices[0]&&(T.vertices[0]=b(0,w.x,w.y,n,!0),c.edges&&(T.prev=c.edges[d],c.edges[d].next=T)),t&&!T.vertices[3]&&(T.vertices[3]=b(3,P.x,P.y,n,!0));let r=e?P:w,i=n.axes[p],s=c.axes[d];o.a.dot(i,s)>0&&(Math.abs(r.x-n.bounds.min.x)<1&&!v(h.Directions.LEFT,n.axes)&&o.a.dot(i,h.Directions.LEFT)<1&&o.a.dot(s,h.Directions.LEFT)<1&&n.ignormals.push(h.Directions.LEFT),Math.abs(r.y-n.bounds.min.y)<1&&!v(h.Directions.UP,n.axes)&&o.a.dot(i,h.Directions.UP)<1&&o.a.dot(s,h.Directions.UP)<1&&n.ignormals.push(h.Directions.UP),Math.abs(r.x-n.bounds.max.x)<1&&!v(h.Directions.RIGHT,n.axes)&&o.a.dot(i,h.Directions.RIGHT)<1&&o.a.dot(s,h.Directions.RIGHT)<1&&n.ignormals.push(h.Directions.RIGHT),Math.abs(r.y-n.bounds.max.y)<1&&!v(h.Directions.DOWN,n.axes)&&o.a.dot(i,h.Directions.DOWN)<1&&o.a.dot(s,h.Directions.DOWN)<1&&n.ignormals.push(h.Directions.DOWN))}}for(p=0;p<s.length;p++)(T=n.edges[p]).ignore||(y=s[((p-1)%s.length+s.length)%s.length],g=s[p],E=s[(p+1)%s.length],M=s[(p+2)%s.length],T.vertices[0]||y.isInternal||(T.vertices[0]=b(0,y.x,y.y,n,!0)),T.vertices[3]||E.isInternal||(T.vertices[3]=b(3,M.x,M.y,n,!0)),T.normals=i.fromVertices(T.vertices),A(T))}}}}};t.default=class{constructor(e){this.scene=e,this.overridden={}}boot(){console.log("Slopes plugin boot()");let e=this.scene.sys.events;e.on("start",this.start,this),e.on("shutdown",this.shutdown,this),e.on("destroy",this.destroy,this),this.start()}start(){if(!Phaser||!Phaser.Physics)return void console.warn("Phaser Slopes plugin could not find Phaser during start up");let e=Phaser.Physics.Matter.Matter.Axes,t=Phaser.Physics.Matter.Matter.Resolver,r=Phaser.Physics.Matter.Matter.SAT,n=Phaser.Physics.Matter.World;this.overridden.convertTilemapLayer=n.prototype.convertTilemapLayer,this.overridden.processEdges=n.prototype.processEdges,this.overridden.collides=r.collides,this.overridden.fromVertices=e.fromVertices,this.overridden.preSolvePosition=t.preSolvePosition,e.fromVertices=E.Matter.Axes.fromVertices,t.preSolvePosition=E.Matter.Resolver.preSolvePosition,r.collides=E.Matter.SAT.collides,n.prototype.convertTilemapLayer=E.Matter.World.convertTilemapLayer,n.prototype.processEdges=E.Matter.World.processEdges,n.prototype.calculateBoundaryEdges=E.Matter.World.calculateBoundaryEdges,n.prototype.compareBoundaryEdges=E.Matter.World.compareBoundaryEdges,n.prototype.calculateEdgeNormals=E.Matter.World.calculateEdgeNormals,n.prototype.flagInternalEdges=E.Matter.World.flagInternalEdges,n.prototype.flagIgnoredAxes=E.Matter.World.flagIgnoredAxes,n.prototype.flagIgnormals=E.Matter.World.flagIgnormals}shutdown(){if(!Phaser||!Phaser.Physics)return void console.warn("Phaser Slopes plugin could not find Phaser during shutdown");let e=Phaser.Physics.Matter.Matter.Axes,t=Phaser.Physics.Matter.Matter.Resolver,r=Phaser.Physics.Matter.Matter.SAT,n=Phaser.Physics.Matter.World;e.fromVertices=this.overridden.fromVertices,t.preSolvePosition=this.overridden.preSolvePosition,t.solvePosition=this.overridden.solvePosition,r.collides=this.overridden.collides,n.prototype.convertTilemapLayer=this.overridden.convertTilemapLayer,n.prototype.processEdges=this.overridden.processEdges,delete n.prototype.calculateBoundaryEdges,delete n.prototype.compareBoundaryEdges,delete n.prototype.calculateEdgeNormals,delete n.prototype.flagInternalEdges,delete n.prototype.flagIgnoredAxes,delete n.prototype.flagIgnormals}destroy(){this.shutdown(),this.scene=null,this.overridden=null}}},function(e,t){e.exports=function(e,t,r){return e>=0&&e<r.width&&t>=0&&t<r.height}},function(e,t){var r={};e.exports=r,function(){r._nextId=0,r._seed=0,r._nowStartTime=+new Date,r.extend=function(e,t){var n,o;"boolean"==typeof t?(n=2,o=t):(n=1,o=!0);for(var i=n;i<arguments.length;i++){var s=arguments[i];if(s)for(var a in s)o&&s[a]&&s[a].constructor===Object?e[a]&&e[a].constructor!==Object?e[a]=s[a]:(e[a]=e[a]||{},r.extend(e[a],o,s[a])):e[a]=s[a]}return e},r.clone=function(e,t){return r.extend({},t,e)},r.keys=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var r in e)t.push(r);return t},r.values=function(e){var t=[];if(Object.keys){for(var r=Object.keys(e),n=0;n<r.length;n++)t.push(e[r[n]]);return t}for(var o in e)t.push(e[o]);return t},r.get=function(e,t,r,n){t=t.split(".").slice(r,n);for(var o=0;o<t.length;o+=1)e=e[t[o]];return e},r.set=function(e,t,n,o,i){var s=t.split(".").slice(o,i);return r.get(e,t,0,-1)[s[s.length-1]]=n,n},r.shuffle=function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(r.random()*(t+1)),o=e[t];e[t]=e[n],e[n]=o}return e},r.choose=function(e){return e[Math.floor(r.random()*e.length)]},r.isElement=function(e){return e instanceof HTMLElement},r.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},r.isFunction=function(e){return"function"==typeof e},r.isPlainObject=function(e){return"object"==typeof e&&e.constructor===Object},r.isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},r.clamp=function(e,t,r){return e<t?t:e>r?r:e},r.sign=function(e){return e<0?-1:1},r.now=function(){if(window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return new Date-r._nowStartTime},r.random=function(t,r){return t=void 0!==t?t:0,r=void 0!==r?r:1,t+e()*(r-t)};var e=function(){return r._seed=(9301*r._seed+49297)%233280,r._seed/233280};r.colorToNumber=function(e){return 3==(e=e.replace("#","")).length&&(e=e.charAt(0)+e.charAt(0)+e.charAt(1)+e.charAt(1)+e.charAt(2)+e.charAt(2)),parseInt(e,16)},r.logLevel=1,r.log=function(){console&&r.logLevel>0&&r.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},r.info=function(){console&&r.logLevel>0&&r.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},r.warn=function(){console&&r.logLevel>0&&r.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},r.nextId=function(){return r._nextId++},r.map=function(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n+=1)r.push(t(e[n]));return r},r.topologicalSort=function(e){var r=[],n=[],o=[];for(var i in e)n[i]||o[i]||t(i,n,o,e,r);return r};var t=function(e,r,n,o,i){var s=o[e]||[];n[e]=!0;for(var a=0;a<s.length;a+=1){var l=s[a];n[l]||(r[l]||t(l,r,n,o,i))}n[e]=!1,r[e]=!0,i.push(e)};r.chain=function(){for(var e=[],t=0;t<arguments.length;t+=1){var r=arguments[t];r._chained?e.push.apply(e,r._chained):e.push(r)}var n=function(){for(var t,r=new Array(arguments.length),n=0,o=arguments.length;n<o;n++)r[n]=arguments[n];for(n=0;n<e.length;n+=1){var i=e[n].apply(t,r);void 0!==i&&(t=i)}return t};return n._chained=e,n},r.chainPathBefore=function(e,t,n){return r.set(e,t,r.chain(n,r.get(e,t)))},r.chainPathAfter=function(e,t,n){return r.set(e,t,r.chain(r.get(e,t),n))}}()}]);